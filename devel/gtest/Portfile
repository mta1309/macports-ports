# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem      1.0
PortGroup       cmake 1.0
PortGroup       github 1.0

github.setup    google googletest 1.8.0 release-
name            gtest
categories      devel
maintainers     blair
license         BSD
description     Google's framework for writing C++ tests

checksums       md5 d2edffbe844902d942c31db70c7cfec2

long_description \
                Google's framework for writing C++ tests on a variety \
                of platforms (Linux, Mac OS X, Windows, Windows CE, \
                Symbian, etc).  Based on the xUnit architecture. \
                Supports automatic test discovery, a rich set of \
                assertions, user-defined assertions, death tests, \
                fatal and non-fatal failures, various options for \
                running the tests, and XML test report generation.

homepage        https://code.google.com/p/googletest/

platforms       darwin

cmake.out_of_source     yes
configure.optflags      -g
configure.args-append   -Dgtest_build_tests=ON

destroot { 
    file copy ${cmake.build_dir}/googlemock/gtest/libgtest.a ${destroot}${prefix}/lib 
    file copy ${cmake.build_dir}/googlemock/gtest/libgtest_main.a ${destroot}${prefix}/lib 
    file copy ${cmake.build_dir}/googlemock/libgmock.a ${destroot}${prefix}/lib 
    file copy ${cmake.build_dir}/googlemock/libgmock_main.a ${destroot}${prefix}/lib 
    file copy ${worksrcpath}/googletest/include/gtest ${destroot}${prefix}/include 
    file copy ${worksrcpath}/googlemock/include/gmock ${destroot}${prefix}/include 
    file mkdir ${destroot}${prefix}/src
    file copy ${worksrcpath}/googletest/src/gtest-all.cc   ${destroot}${prefix}/src
    file copy ${worksrcpath}/googletest/src/gtest-death-test.cc   ${destroot}${prefix}/src
    file copy ${worksrcpath}/googletest/src/gtest-filepath.cc   ${destroot}${prefix}/src
    file copy ${worksrcpath}/googletest/src/gtest-internal-inl.h   ${destroot}${prefix}/src
    file copy ${worksrcpath}/googletest/src/gtest-port.cc   ${destroot}${prefix}/src
    file copy ${worksrcpath}/googletest/src/gtest-printers.cc   ${destroot}${prefix}/src
    file copy ${worksrcpath}/googletest/src/gtest-test-part.cc   ${destroot}${prefix}/src
    file copy ${worksrcpath}/googletest/src/gtest-typed-test.cc   ${destroot}${prefix}/src
    file copy ${worksrcpath}/googletest/src/gtest.cc   ${destroot}${prefix}/src
    file copy ${worksrcpath}/googletest/src/gtest_main.cc   ${destroot}${prefix}/src
    file copy ${worksrcpath}/googlemock/src/gmock-all.cc   ${destroot}${prefix}/src
    file copy ${worksrcpath}/googlemock/src/gmock-cardinalities.cc   ${destroot}${prefix}/src
    file copy ${worksrcpath}/googlemock/src/gmock-internal-utils.cc   ${destroot}${prefix}/src
    file copy ${worksrcpath}/googlemock/src/gmock-matchers.cc   ${destroot}${prefix}/src
    file copy ${worksrcpath}/googlemock/src/gmock-spec-builders.cc   ${destroot}${prefix}/src
    file copy ${worksrcpath}/googlemock/src/gmock.cc   ${destroot}${prefix}/src
    file copy ${worksrcpath}/googlemock/src/gmock_main.cc   ${destroot}${prefix}/src
} 

test.run    yes
test.cmd    "ulimit -c 0; make"
test.target test
